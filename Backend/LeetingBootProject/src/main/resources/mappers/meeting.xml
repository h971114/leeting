<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="meeting">
	<!-- 미팅 등록 -->
	<insert id="enrollMeeting" parameterType="meeting">
		INSERT INTO meeting ( maintitle, subtitle, date, hostid, detail, categoryno, file,enddate)
		VALUES ( #{maintitle},  #{subtitle}, #{date}, #{hostid},#{detail},#{categoryno},#{file},#{enddate})
	</insert>
	<!-- 미팅 목록 -->
 	<select id="listMeeting" resultType="meeting">
		SELECT no AS meetingno, maintitle, subtitle, date, hostid, detail, categoryno, file ,enddate, meetinglike, participants FROM meeting ORDER BY no DESC
	</select>
	<select id="listMeetingCategory" parameterType="int" resultType="meeting">
		SELECT no AS meetingno, maintitle, subtitle, date, hostid, detail, categoryno, file  ,enddate, meetinglike, participants FROM meeting WHERE categoryno = #{categoryno} ORDER BY no DESC
	</select>
	<!-- 미팅상세정보 -->
	<select id="meetinginfo" parameterType="int" resultType="meeting">
		SELECT * FROM meeting WHERE no = #{meetingno}
	</select>
	<!-- 미팅 삭제 -->
	<delete id="meetingdelete" parameterType="int">
		DELETE FROM participation WHERE meetingno=#{meetingno};
		DELETE FROM meeting WHERE no=#{meetingno};		
	</delete>
	<!-- 미팅 수정 -->
	<update id="meetingmodify" parameterType="meeting">
		UPDATE meeting SET maintitle=#{maintitle},subtitle=#{subtitle},date=#{date},hostid=#{hostid},detail=#{detail},categoryno=#{categoryno},file=#{file},enddate=#{enddate} WHERE no=#{meetingno}
	</update>
	<!-- 미팅 참여자 정보 -->
	<select id="listparticipants" parameterType="int" resultType="participation">
		SELECT * FROM participation WHERE meetingno=#{meetingno}
	</select>
	<!-- 좋아요 수정	-->
	<update id="setlikestatus" parameterType="participation">
		UPDATE participation
		SEt likestatus = #{likestatus}
		where userid = #{userid} and meetingno = #{meetingno}
	</update>
	<!-- 미팅 참석-->
	<insert id="clickmeeting" parameterType="participation">
		INSERT INTO participation (meetingno, userid, likestatus)
		VALUES (#{meetingno}, #{userid}, 0)
	</insert>
	<!-- 미팅 참여자 정보: 중복 검사 -->
	<select id="participationinfo" parameterType="participation" resultType="participation">
		SELECT no, meetingno, userid, likestatus
		FROM participation
		WHERE userid = #{userid} and meetingno = #{meetingno}
	</select>
</mapper>